"use strict";!function(){window.qs=function(e,n){return(n||document).querySelector(e)},window.$on=function(e,n,t,i){e.addEventListener(n,t,!!i)},window.$parent=function(e,n){return e.parentNode?e.parentNode.tagName.toLowerCase()===n.toLowerCase()?e.parentNode:window.$parent(e.parentNode,n):void 0},window.$createImgSource=function(e){return"https://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.id+"_"+e.secret+".jpg"},window.$addClass=function(e,n){e.classList?e.classList.add(n):e.className+=" ${className}"},window.$removeClass=function(e,n){e.classList?e.classList.remove(n):e.className=e.className.replace(new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi")," ")},window.$renderOverlay=function(e){var n=window.qs(".lightbox-image");n.setAttribute("src",e)},window.$debounce=function(e,n){var t=null;return function(){var i=this,a=arguments;clearTimeout(t),t=setTimeout(function(){e.apply(i,a)},n)}}}(window);var Grid=function(){var e=function(e,n){fetch("https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=851eba61830c7c59ab64308b75eec2f7&tags="+e+"%2C+film&sort=relevance&per_page=10&page=1&format=json&nojsoncallback=1").then(function(e){return e.json()}).then(function(e){n(e)})},n=function(e){return e.map(function(e){return e.src=window.$createImgSource(e),e})},t=function(e){for(;e.firstChild;)e.removeChild(e.firstChild);e.textContent=""},i=function(e){t(window.qs("main")),e.forEach(function(e){var n=document.createElement("div");n.className="grid-image-container";var t=document.createElement("div");t.className="grid-image",t.style.backgroundImage="url("+e.src+")",n.appendChild(t),n.setAttribute("data-image-id",e.id),window.$on(n,"click",function(e){e.srcElement.dispatchEvent(window.$stateEvent("openModal")),window.$addClass(window.qs(".overlay"),"is-open")}),window.qs("main").appendChild(n)})};return{fetchImages:e,mapImages:n,removeImages:t,renderImages:i}},Emulsion=function(){var e={modalOpen:!1,images:null,lightbox:null,currFilmType:"ektar",currFilmIndex:"0",availFilmTypes:["ektar","portra","tri-x","superia","velvia"]},n=window.Grid(),t=function(n,t,i){e[n]=t,void 0!==i&&i(t)},i=function(n){return void 0===n?e:e[n]},a=function(){n.fetchImages(e.currFilmType,function(i){t("images",n.mapImages(i.photos.photo),function(){n.renderImages(e.images)})})},o=function(){window.qs("#current-film").innerHTML=e.currFilmType},r=function(){var i=null,r=0;void 0!==e.availFilmTypes[e.currFilmIndex+1]?(i=e.availFilmTypes[e.currFilmIndex+1],r=e.currFilmIndex+1):i=e.availFilmTypes[r],t("currFilmType",i),t("currFilmIndex",r,function(){a(),n.renderImages(e.images),o()})},c=function(e,n){var a=i("images").reduce(function(n,t,i){return t.id===e?i:null!==n?n:void 0},null);switch(n){case"prevImage":t("lightbox",i("lightbox")-1);break;case"nextImage":t("lightbox",i("lightbox")+1);break;case"openModal":t("lightbox",a);break;case"closeModal":t("lightbox",null)}};o(),a();var s=window.qs(".app-container");return window.$on(s,"stateChange",function(e){switch(e.detail.action){case"nextImage":c(null,"nextImage"),window.$renderOverlay(i("images")[i("lightbox")].src);break;case"prevImage":c(null,"prevImage"),window.$renderOverlay(i("images")[i("lightbox")].src);break;case"closeModal":t("modalOpen",!1),t("lightbox",null);break;case"openModal":var n=e.srcElement.parentElement.attributes["data-image-id"].value;t("modalOpen",!0),c(n,"openModal"),window.$renderOverlay(i("images").find(function(e){return e.id===n}).src)}console.log("Action Type: "+e.detail.action),console.log(i())}),{getState:i,nextFilmType:r}}(),init=function(){var e=window.Emulsion;window.$on(window.qs("#next-film-arrow"),"click",e.nextFilmType);var n=window.qs(".overlay"),t=window.qs(".modal-close-btn");window.$on(t,"click",function(e){e.srcElement.dispatchEvent(window.$stateEvent("closeModal")),window.$removeClass(n,"is-open")});var i=window.qs(".overlay-right");window.$on(i,"click",function(e){e.srcElement.dispatchEvent(window.$stateEvent("nextImage"))});var a=window.qs(".overlay-left");window.$on(a,"click",function(e){e.srcElement.dispatchEvent(window.$stateEvent("prevImage"))}),window.$stateEvent=function(n,t){return new CustomEvent("stateChange",{detail:{action:n,callback:t,state:e.getState(),time:new Date},bubbles:!0,cancelable:!0})}}();